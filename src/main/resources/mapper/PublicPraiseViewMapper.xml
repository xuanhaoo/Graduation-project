<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.abc.dao.PublicPraiseViewMapper">


    <resultMap id="PublicPraiseViewMap" type="PublicPraiseView">
        <id property="id" column="id"/>
        <result property="type"  column="type" />
        <result property="spotId"  column="spot_id" />
        <result property="facilities"  column="facilities" />
        <result property="service"  column="service" />
        <result property="scenery"  column="scenery" />
        <result property="manage"  column="manage" />
        <result property="passengerFlow"  column="passenger_flow" />
        <result property="diet"  column="diet" />
        <result property="transport"  column="transport" />
        <result property="comment"  column="comment" />
        <result property="createDate"  column="create_date" jdbcType="TIMESTAMP" />
        <result property="createBy"  column="create_by" />
        <result property="authorName"  column="authorName" />
        <result property="spotName"  column="spotName" />
    </resultMap>


    <select id="queryPublicPraiseByLeftJoin" resultMap="PublicPraiseViewMap">
        select t1.*, t2.name as spotName, t3.nick_name as authorName from public_praise_view t1
        left join view_spot_info t2 on t1.spot_id = t2.id
        left join  customer t3 on t1.create_by = t3.id
        <where>
            <if test="spotKeyWord != null and spotKeyWord != ''">
                t2.`name` like CONCAT('%',#{spotKeyWord},'%')
            </if>
        </where>
        order by t1.create_date desc
    </select>


    <select id="analysisPublicPraiseData" resultType="com.abc.vo.PublicEchartsJson">
        select count(*) as totalSum,DATE_FORMAT(create_date, "%Y-%m-%d") as dateStage from public_praise_view
        where <![CDATA[ create_date  >=  DATE_FORMAT(#{setTime}, "%Y-%m-%d")  ]]>
        group by DATE_FORMAT(create_date, "%Y-%m-%d") order by dateStage
    </select>


    <select id="queryPublicBySpotId" resultMap="PublicPraiseViewMap">
        select t1.*, t2.name as spotName, t3.nick_name as authorName from public_praise_view t1
        left join view_spot_info t2 on t1.spot_id = t2.id
        left join  customer t3 on t1.create_by = t3.id
        <where>
            <if test="spotId != null and spotId != 0">
              t1.`spot_id` = #{spotId}
            </if>
        </where>
        order by t1.create_date desc
    </select>
</mapper>